<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Epic PvE Combat Arena - Gemini Canvas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation;
        }

        .game-container {
            width: 100vw;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: linear-gradient(90deg, #0f3460 0%, #16213e 50%, #0f3460 100%);
            border-bottom: 3px solid #3498db;
            font-size: 1em;
            height: 80px;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .combat-title {
            text-align: center;
            flex: 1;
        }

        .combat-title h1 {
            font-size: 1.8em;
            color: #f39c12;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
            margin-bottom: 5px;
        }

        .combat-subtitle {
            font-size: 0.9em;
            color: #9b59b6;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
        }

        .canvas-container {
            flex: 1;
            position: relative;
            overflow: hidden;
        }

        #game-canvas {
            width: 100%;
            height: 100%;
            display: block;
            background: radial-gradient(circle at center, #2c3e50 0%, #1a252f 70%, #0f1419 100%);
        }

        .combat-controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            z-index: 100;
        }

        .monster-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px 25px;
            border-radius: 15px;
            border: 2px solid #3498db;
            box-shadow: 0 8px 32px rgba(52, 152, 219, 0.4);
        }

        .monster-dropdown {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: #ecf0f1;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 12px 20px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
            text-align: center;
        }

        .monster-dropdown:hover {
            background: linear-gradient(135deg, #3498db, #2980b9);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.6);
        }

        .action-buttons {
            display: flex;
            gap: 15px;
        }

        .action-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            font-size: 1.2em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
            min-width: 120px;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.6);
        }

        .action-btn.engage {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.4);
        }

        .action-btn.engage:hover {
            box-shadow: 0 6px 20px rgba(243, 156, 18, 0.6);
        }

        .action-btn.cast {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            box-shadow: 0 4px 15px rgba(155, 89, 182, 0.4);
        }

        .action-btn.cast:hover {
            box-shadow: 0 6px 20px rgba(155, 89, 182, 0.6);
        }

        .action-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .character-selection {
            display: flex;
            gap: 20px;
            margin-bottom: 10px;
        }

        .character-btn {
            background: linear-gradient(135deg, #34495e, #2c3e50);
            color: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 10px 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .character-btn.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.6);
        }

        .character-btn:hover {
            transform: translateY(-1px);
        }

        .combat-info {
            position: absolute;
            top: 100px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            padding: 15px;
            border-radius: 10px;
            border: 2px solid #3498db;
            max-width: 300px;
            z-index: 50;
        }

        .combat-log {
            position: absolute;
            top: 100px;
            right: 20px;
            width: 250px;
            height: 200px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 10px;
            overflow-y: auto;
            z-index: 50;
        }

        .log-entry {
            color: #ecf0f1;
            font-size: 0.9em;
            margin-bottom: 5px;
            padding: 3px 5px;
            border-radius: 3px;
        }

        .log-entry.damage {
            background: rgba(231, 76, 60, 0.3);
            color: #ff6b6b;
        }

        .log-entry.cast {
            background: rgba(155, 89, 182, 0.3);
            color: #bb86fc;
        }

        .log-entry.engage {
            background: rgba(243, 156, 18, 0.3);
            color: #ffd93d;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .pulsing {
            animation: pulse 2s infinite;
        }

        @keyframes glow {
            0% { box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4); }
            50% { box-shadow: 0 8px 30px rgba(52, 152, 219, 0.8); }
            100% { box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4); }
        }

        .glowing {
            animation: glow 2s infinite;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <div class="combat-title">
                <h1>‚öîÔ∏è EPIC PvE COMBAT ARENA ‚öîÔ∏è</h1>
                <div class="combat-subtitle">Choose your warrior and face legendary monsters!</div>
            </div>
        </div>
        
        <div class="canvas-container">
            <canvas id="game-canvas"></canvas>
            
            <div class="combat-info">
                <h3 style="color: #3498db; margin-bottom: 10px;">üõ°Ô∏è Combat Status</h3>
                <div id="player-status">
                    <div>Character: <span id="current-character">Wizard</span></div>
                    <div>Health: <span id="player-health">100%</span></div>
                    <div>Mana: <span id="player-mana">100%</span></div>
                </div>
                <div id="monster-status" style="margin-top: 10px;">
                    <div>Monster: <span id="current-monster">None Selected</span></div>
                    <div>Health: <span id="monster-health">100%</span></div>
                </div>
            </div>
            
            <div class="combat-log">
                <h4 style="color: #3498db; margin-bottom: 10px;">üìú Combat Log</h4>
                <div id="log-entries"></div>
            </div>
            
            <div class="combat-controls">
                <div class="character-selection">
                    <button class="character-btn active" onclick="selectCharacter('wizard')">üßô‚Äç‚ôÇÔ∏è Wizard</button>
                    <button class="character-btn" onclick="selectCharacter('knight')">‚öîÔ∏è Knight</button>
                </div>
                
                <div class="monster-selection">
                    <label style="color: #3498db; font-weight: bold; margin-bottom: 5px;">Select Monster:</label>
                    <select class="monster-dropdown" id="monster-select">
                        <option value="">Choose your enemy...</option>
                        <option value="goblin">üßå Savage Goblin (Level 1)</option>
                        <option value="orc">üëπ Brutal Orc (Level 3)</option>
                        <option value="troll">üßü Ancient Troll (Level 5)</option>
                        <option value="dragon">üêâ Fire Dragon (Level 10)</option>
                        <option value="demon">üë∫ Shadow Demon (Level 15)</option>
                        <option value="titan">üóø Stone Titan (Level 20)</option>
                    </select>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn engage" onclick="engageMonster()" id="engage-btn" disabled>üéØ ENGAGE</button>
                    <button class="action-btn" onclick="attackMonster()" id="attack-btn" disabled>‚öîÔ∏è ATTACK</button>
                    <button class="action-btn cast" onclick="castSpell()" id="cast-btn" disabled>üîÆ CAST</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Epic PvE Combat Game
        class PvECombatGame {
            constructor() {
                this.canvas = document.getElementById('game-canvas');
                this.ctx = this.canvas.getContext('2d');
                
                this.setupCanvas();
                
                // Game state
                this.currentCharacter = 'wizard';
                this.selectedMonster = null;
                this.isEngaged = false;
                this.combatActive = false;
                
                // Game objects
                this.player = null;
                this.monster = null;
                this.particles = [];
                this.effects = [];
                this.spells = [];
                this.swordTrails = [];
                
                // Animation states
                this.wizardAnimation = {
                    casting: false,
                    castFrame: 0,
                    staffGlow: 0
                };
                
                this.knightAnimation = {
                    attacking: false,
                    attackFrame: 0,
                    swordAngle: 0,
                    attackSpeed: 1,
                    fireIntensity: 0,
                    comboCount: 0
                };
                
                this.monsterData = {
                    goblin: { name: 'Savage Goblin', health: 100, maxHealth: 100, level: 1, color: '#8B4513', size: 30 },
                    orc: { name: 'Brutal Orc', health: 200, maxHealth: 200, level: 3, color: '#654321', size: 40 },
                    troll: { name: 'Ancient Troll', health: 350, maxHealth: 350, level: 5, color: '#556B2F', size: 50 },
                    dragon: { name: 'Fire Dragon', health: 500, maxHealth: 500, level: 10, color: '#DC143C', size: 70 },
                    demon: { name: 'Shadow Demon', health: 750, maxHealth: 750, level: 15, color: '#800080', size: 60 },
                    titan: { name: 'Stone Titan', health: 1000, maxHealth: 1000, level: 20, color: '#708090', size: 80 }
                };
                
                this.init();
            }
            
            setupCanvas() {
                const rect = this.canvas.getBoundingClientRect();
                this.canvas.width = rect.width;
                this.canvas.height = rect.height;
            }
            
            init() {
                this.createPlayer();
                this.startGameLoop();
                this.setupEventListeners();
            }
            
            setupEventListeners() {
                document.getElementById('monster-select').addEventListener('change', (e) => {
                    if (e.target.value) {
                        this.selectMonster(e.target.value);
                    }
                });
                
                window.addEventListener('resize', () => this.setupCanvas());
            }
            
            createPlayer() {
                this.player = {
                    x: this.canvas.width / 4,
                    y: this.canvas.height / 2,
                    health: 100,
                    maxHealth: 100,
                    mana: 100,
                    maxMana: 100,
                    size: 25
                };
            }
            
            selectMonster(monsterType) {
                const data = this.monsterData[monsterType];
                this.selectedMonster = {
                    type: monsterType,
                    x: (this.canvas.width * 3) / 4,
                    y: this.canvas.height / 2,
                    ...data,
                    animationFrame: 0,
                    isIdle: true
                };
                
                document.getElementById('current-monster').textContent = data.name;
                document.getElementById('monster-health').textContent = '100%';
                document.getElementById('engage-btn').disabled = false;
                
                this.logMessage(`Selected ${data.name} as target`, 'engage');
            }
            
            createParticle(x, y, color, size = 3, vx = 0, vy = 0, life = 60) {
                this.particles.push({
                    x, y, color, size, vx, vy, life, maxLife: life, alpha: 1
                });
            }
            
            createExplosion(x, y, color = '#FF6B35', particleCount = 15) {
                for (let i = 0; i < particleCount; i++) {
                    const angle = (Math.PI * 2 * i) / particleCount;
                    const speed = 3 + Math.random() * 4;
                    const vx = Math.cos(angle) * speed;
                    const vy = Math.sin(angle) * speed;
                    this.createParticle(x, y, color, 4 + Math.random() * 3, vx, vy, 40 + Math.random() * 20);
                }
            }
            
            createMagicSpell(startX, startY, targetX, targetY) {
                const spell = {
                    x: startX,
                    y: startY,
                    targetX,
                    targetY,
                    speed: 8,
                    size: 12,
                    trail: [],
                    color: '#9932CC',
                    glowSize: 0,
                    active: true
                };
                
                // Calculate direction
                const dx = targetX - startX;
                const dy = targetY - startY;
                const distance = Math.sqrt(dx * dx + dy * dy);
                spell.vx = (dx / distance) * spell.speed;
                spell.vy = (dy / distance) * spell.speed;
                
                this.spells.push(spell);
            }
            
            createSwordTrail(x, y, angle, intensity = 1) {
                const length = 40 * intensity;
                const trail = {
                    x, y, angle, length, 
                    life: 15, 
                    maxLife: 15, 
                    intensity,
                    color: intensity > 2 ? '#FF4500' : '#FFD700'
                };
                this.swordTrails.push(trail);
            }
            
            updateParticles() {
                this.particles = this.particles.filter(particle => {
                    particle.x += particle.vx;
                    particle.y += particle.vy;
                    particle.vy += 0.1; // gravity
                    particle.vx *= 0.98; // air resistance
                    particle.life--;
                    particle.alpha = particle.life / particle.maxLife;
                    particle.size *= 0.98;
                    return particle.life > 0;
                });
            }
            
            updateSpells() {
                this.spells = this.spells.filter(spell => {
                    if (!spell.active) return false;
                    
                    // Add to trail
                    spell.trail.push({x: spell.x, y: spell.y});
                    if (spell.trail.length > 8) spell.trail.shift();
                    
                    spell.x += spell.vx;
                    spell.y += spell.vy;
                    spell.glowSize = Math.sin(Date.now() * 0.01) * 3 + 5;
                    
                    // Sparkle particles
                    if (Math.random() < 0.3) {
                        this.createParticle(
                            spell.x + (Math.random() - 0.5) * 10,
                            spell.y + (Math.random() - 0.5) * 10,
                            ['#9932CC', '#FF69B4', '#00FFFF'][Math.floor(Math.random() * 3)],
                            2 + Math.random() * 2,
                            (Math.random() - 0.5) * 2,
                            (Math.random() - 0.5) * 2,
                            20
                        );
                    }
                    
                    // Check collision with monster
                    if (this.selectedMonster && spell.active) {
                        const dx = spell.x - this.selectedMonster.x;
                        const dy = spell.y - this.selectedMonster.y;
                        if (Math.sqrt(dx * dx + dy * dy) < this.selectedMonster.size) {
                            this.createExplosion(spell.x, spell.y, '#9932CC', 20);
                            this.damageMonster(25 + Math.random() * 25);
                            spell.active = false;
                            return false;
                        }
                    }
                    
                    // Remove if off screen
                    return spell.x > -50 && spell.x < this.canvas.width + 50 && 
                           spell.y > -50 && spell.y < this.canvas.height + 50;
                });
            }
            
            updateSwordTrails() {
                this.swordTrails = this.swordTrails.filter(trail => {
                    trail.life--;
                    return trail.life > 0;
                });
            }
            
            damageMonster(damage) {
                if (!this.selectedMonster) return;
                
                this.selectedMonster.health -= damage;
                if (this.selectedMonster.health < 0) this.selectedMonster.health = 0;
                
                const healthPercent = (this.selectedMonster.health / this.selectedMonster.maxHealth) * 100;
                document.getElementById('monster-health').textContent = `${Math.round(healthPercent)}%`;
                
                this.logMessage(`Dealt ${Math.round(damage)} damage!`, 'damage');
                
                // Monster death
                if (this.selectedMonster.health <= 0) {
                    this.createExplosion(this.selectedMonster.x, this.selectedMonster.y, '#FFD700', 30);
                    this.logMessage(`${this.selectedMonster.name} defeated!`, 'engage');
                    this.selectedMonster = null;
                    this.isEngaged = false;
                    this.combatActive = false;
                    document.getElementById('current-monster').textContent = 'None Selected';
                    document.getElementById('monster-health').textContent = '100%';
                    document.getElementById('engage-btn').disabled = true;
                    document.getElementById('attack-btn').disabled = true;
                    document.getElementById('cast-btn').disabled = true;
                }
            }
            
            drawPlayer() {
                if (!this.player) return;
                
                const ctx = this.ctx;
                const player = this.player;
                
                if (this.currentCharacter === 'wizard') {
                    // Wizard body
                    ctx.fillStyle = '#4B0082';
                    ctx.beginPath();
                    ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Wizard hat
                    ctx.fillStyle = '#191970';
                    ctx.beginPath();
                    ctx.moveTo(player.x - 15, player.y - 20);
                    ctx.lineTo(player.x + 15, player.y - 20);
                    ctx.lineTo(player.x, player.y - 40);
                    ctx.closePath();
                    ctx.fill();
                    
                    // Staff
                    const staffX = player.x + 20;
                    const staffY = player.y - 10;
                    const staffEndY = staffY - 50;
                    
                    ctx.strokeStyle = '#8B4513';
                    ctx.lineWidth = 4;
                    ctx.beginPath();
                    ctx.moveTo(staffX, staffY);
                    ctx.lineTo(staffX, staffEndY);
                    ctx.stroke();
                    
                    // Staff orb with glow
                    const glowSize = this.wizardAnimation.staffGlow + 8;
                    const gradient = ctx.createRadialGradient(staffX, staffEndY, 0, staffX, staffEndY, glowSize);
                    gradient.addColorStop(0, '#9932CC');
                    gradient.addColorStop(0.5, '#FF69B4');
                    gradient.addColorStop(1, 'rgba(153, 50, 204, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(staffX, staffEndY, glowSize, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Casting animation
                    if (this.wizardAnimation.casting) {
                        this.wizardAnimation.castFrame++;
                        this.wizardAnimation.staffGlow = Math.sin(this.wizardAnimation.castFrame * 0.3) * 5 + 5;
                        
                        // Magic sparkles around wizard
                        for (let i = 0; i < 3; i++) {
                            const angle = this.wizardAnimation.castFrame * 0.1 + (i * Math.PI * 2 / 3);
                            const sparkleX = player.x + Math.cos(angle) * 30;
                            const sparkleY = player.y + Math.sin(angle) * 30;
                            this.createParticle(sparkleX, sparkleY, '#9932CC', 3, 0, 0, 10);
                        }
                        
                        if (this.wizardAnimation.castFrame > 30) {
                            this.wizardAnimation.casting = false;
                            this.wizardAnimation.castFrame = 0;
                        }
                    } else {
                        this.wizardAnimation.staffGlow = Math.sin(Date.now() * 0.005) * 2 + 3;
                    }
                    
                } else if (this.currentCharacter === 'knight') {
                    // Knight body
                    ctx.fillStyle = '#C0C0C0';
                    ctx.beginPath();
                    ctx.arc(player.x, player.y, player.size, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Knight helmet
                    ctx.fillStyle = '#A9A9A9';
                    ctx.beginPath();
                    ctx.arc(player.x, player.y - 10, 20, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Sword
                    const swordX = player.x + 25;
                    const swordY = player.y - 5;
                    const angle = this.knightAnimation.swordAngle;
                    
                    ctx.save();
                    ctx.translate(swordX, swordY);
                    ctx.rotate(angle);
                    
                    // Sword blade with fire effect
                    const fireIntensity = this.knightAnimation.fireIntensity;
                    if (fireIntensity > 0) {
                        // Fire glow
                        const fireGradient = ctx.createLinearGradient(0, -30, 0, 0);
                        fireGradient.addColorStop(0, `rgba(255, ${100 + fireIntensity * 155}, 0, ${fireIntensity})`);
                        fireGradient.addColorStop(1, `rgba(255, 0, 0, ${fireIntensity * 0.5})`);
                        
                        ctx.fillStyle = fireGradient;
                        ctx.fillRect(-3, -35, 6, 35);
                        
                        // Fire particles
                        for (let i = 0; i < fireIntensity * 3; i++) {
                            const fx = (Math.random() - 0.5) * 8;
                            const fy = -35 + Math.random() * 35;
                            this.createParticle(
                                swordX + fx, swordY + fy,
                                ['#FF4500', '#FF6347', '#FFD700'][Math.floor(Math.random() * 3)],
                                2, 0, -2, 15
                            );
                        }
                    }
                    
                    ctx.fillStyle = fireIntensity > 0.5 ? '#FFD700' : '#D3D3D3';
                    ctx.fillRect(-2, -30, 4, 30);
                    
                    // Sword hilt
                    ctx.fillStyle = '#8B4513';
                    ctx.fillRect(-3, -5, 6, 10);
                    
                    ctx.restore();
                    
                    // Attack animation
                    if (this.knightAnimation.attacking) {
                        this.knightAnimation.attackFrame++;
                        const attackProgress = this.knightAnimation.attackFrame / 20;
                        this.knightAnimation.swordAngle = Math.sin(attackProgress * Math.PI * this.knightAnimation.attackSpeed) * Math.PI / 2;
                        
                        // Increase attack speed and fire with combo
                        this.knightAnimation.attackSpeed += 0.05;
                        this.knightAnimation.fireIntensity = Math.min(1, this.knightAnimation.fireIntensity + 0.1);
                        
                        // Create sword trail
                        this.createSwordTrail(swordX, swordY, angle, this.knightAnimation.fireIntensity + 1);
                        
                        if (this.knightAnimation.attackFrame > 20) {
                            this.knightAnimation.attacking = false;
                            this.knightAnimation.attackFrame = 0;
                            this.knightAnimation.comboCount++;
                            
                            // Reset combo after pause
                            setTimeout(() => {
                                if (!this.knightAnimation.attacking) {
                                    this.knightAnimation.attackSpeed = 1;
                                    this.knightAnimation.fireIntensity *= 0.8;
                                    this.knightAnimation.comboCount = 0;
                                }
                            }, 1000);
                        }
                    } else {
                        this.knightAnimation.swordAngle = 0;
                        this.knightAnimation.fireIntensity *= 0.95;
                    }
                }
                
                // Player name tag
                ctx.fillStyle = '#3498db';
                ctx.font = 'bold 14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(this.currentCharacter.toUpperCase(), player.x, player.y - player.size - 50);
            }
            
            drawMonster() {
                if (!this.selectedMonster) return;
                
                const ctx = this.ctx;
                const monster = this.selectedMonster;
                
                // Monster body with animation
                monster.animationFrame += 0.1;
                const bounce = Math.sin(monster.animationFrame) * 3;
                
                ctx.fillStyle = monster.color;
                ctx.beginPath();
                ctx.arc(monster.x, monster.y + bounce, monster.size, 0, Math.PI * 2);
                ctx.fill();
                
                // Monster eyes
                ctx.fillStyle = '#FF0000';
                ctx.beginPath();
                ctx.arc(monster.x - 8, monster.y - 5 + bounce, 3, 0, Math.PI * 2);
                ctx.arc(monster.x + 8, monster.y - 5 + bounce, 3, 0, Math.PI * 2);
                ctx.fill();
                
                // Monster features based on type
                switch(monster.type) {
                    case 'dragon':
                        // Dragon wings
                        ctx.fillStyle = '#8B0000';
                        ctx.beginPath();
                        ctx.ellipse(monster.x - 40, monster.y + bounce, 25, 15, Math.PI/4, 0, Math.PI * 2);
                        ctx.ellipse(monster.x + 40, monster.y + bounce, 25, 15, -Math.PI/4, 0, Math.PI * 2);
                        ctx.fill();
                        break;
                    case 'demon':
                        // Demon horns
                        ctx.fillStyle = '#4B0000';
                        ctx.beginPath();
                        ctx.moveTo(monster.x - 15, monster.y - 15 + bounce);
                        ctx.lineTo(monster.x - 20, monster.y - 35 + bounce);
                        ctx.lineTo(monster.x - 10, monster.y - 30 + bounce);
                        ctx.closePath();
                        ctx.moveTo(monster.x + 15, monster.y - 15 + bounce);
                        ctx.lineTo(monster.x + 20, monster.y - 35 + bounce);
                        ctx.lineTo(monster.x + 10, monster.y - 30 + bounce);
                        ctx.closePath();
                        ctx.fill();
                        break;
                }
                
                // Health bar
                const barWidth = monster.size * 2;
                const barHeight = 6;
                const healthPercent = monster.health / monster.maxHealth;
                
                ctx.fillStyle = '#2c3e50';
                ctx.fillRect(monster.x - barWidth/2, monster.y - monster.size - 20, barWidth, barHeight);
                
                ctx.fillStyle = healthPercent > 0.5 ? '#27ae60' : healthPercent > 0.25 ? '#f39c12' : '#e74c3c';
                ctx.fillRect(monster.x - barWidth/2, monster.y - monster.size - 20, barWidth * healthPercent, barHeight);
                
                // Monster name and level
                ctx.fillStyle = '#e74c3c';
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText(`${monster.name} (Lv.${monster.level})`, monster.x, monster.y - monster.size - 35);
            }
            
            drawSpells() {
                this.spells.forEach(spell => {
                    const ctx = this.ctx;
                    
                    // Spell trail
                    spell.trail.forEach((point, index) => {
                        const alpha = index / spell.trail.length;
                        const size = (index / spell.trail.length) * spell.size;
                        
                        ctx.globalAlpha = alpha * 0.7;
                        ctx.fillStyle = spell.color;
                        ctx.beginPath();
                        ctx.arc(point.x, point.y, size, 0, Math.PI * 2);
                        ctx.fill();
                    });
                    
                    // Main spell projectile
                    ctx.globalAlpha = 1;
                    const gradient = ctx.createRadialGradient(spell.x, spell.y, 0, spell.x, spell.y, spell.size + spell.glowSize);
                    gradient.addColorStop(0, spell.color);
                    gradient.addColorStop(0.5, '#FF69B4');
                    gradient.addColorStop(1, 'rgba(153, 50, 204, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(spell.x, spell.y, spell.size + spell.glowSize, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // Core
                    ctx.fillStyle = '#FFFFFF';
                    ctx.beginPath();
                    ctx.arc(spell.x, spell.y, spell.size * 0.5, 0, Math.PI * 2);
                    ctx.fill();
                });
            }
            
            drawSwordTrails() {
                this.swordTrails.forEach(trail => {
                    const ctx = this.ctx;
                    const alpha = trail.life / trail.maxLife;
                    
                    ctx.globalAlpha = alpha;
                    ctx.strokeStyle = trail.color;
                    ctx.lineWidth = 8 * trail.intensity;
                    ctx.lineCap = 'round';
                    
                    ctx.save();
                    ctx.translate(trail.x, trail.y);
                    ctx.rotate(trail.angle);
                    
                    ctx.beginPath();
                    ctx.moveTo(-trail.length/2, 0);
                    ctx.lineTo(trail.length/2, 0);
                    ctx.stroke();
                    
                    ctx.restore();
                    ctx.globalAlpha = 1;
                });
            }
            
            drawParticles() {
                this.particles.forEach(particle => {
                    this.ctx.globalAlpha = particle.alpha;
                    this.ctx.fillStyle = particle.color;
                    this.ctx.beginPath();
                    this.ctx.arc(particle.x, particle.y, particle.size, 0, Math.PI * 2);
                    this.ctx.fill();
                });
                this.ctx.globalAlpha = 1;
            }
            
            drawBackground() {
                const ctx = this.ctx;
                
                // Animated background
                const time = Date.now() * 0.001;
                
                // Energy lines
                ctx.strokeStyle = 'rgba(52, 152, 219, 0.3)';
                ctx.lineWidth = 2;
                for (let i = 0; i < 5; i++) {
                    const y = (this.canvas.height / 6) * (i + 1) + Math.sin(time + i) * 20;
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(this.canvas.width, y);
                    ctx.stroke();
                }
                
                // Floating particles
                if (Math.random() < 0.1) {
                    this.createParticle(
                        Math.random() * this.canvas.width,
                        this.canvas.height + 10,
                        ['#3498db', '#9b59b6', '#f39c12'][Math.floor(Math.random() * 3)],
                        1 + Math.random() * 2,
                        (Math.random() - 0.5) * 0.5,
                        -0.5 - Math.random() * 0.5,
                        120 + Math.random() * 60
                    );
                }
                
                // Center combat area highlight
                if (this.combatActive) {
                    const centerX = this.canvas.width / 2;
                    const centerY = this.canvas.height / 2;
                    const radius = 150 + Math.sin(time * 2) * 20;
                    
                    const gradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius);
                    gradient.addColorStop(0, 'rgba(231, 76, 60, 0.1)');
                    gradient.addColorStop(1, 'rgba(231, 76, 60, 0)');
                    
                    ctx.fillStyle = gradient;
                    ctx.beginPath();
                    ctx.arc(centerX, centerY, radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            logMessage(message, type = 'info') {
                const logEntries = document.getElementById('log-entries');
                const entry = document.createElement('div');
                entry.className = `log-entry ${type}`;
                entry.textContent = `${new Date().toLocaleTimeString()}: ${message}`;
                logEntries.appendChild(entry);
                logEntries.scrollTop = logEntries.scrollHeight;
                
                // Keep only last 20 entries
                while (logEntries.children.length > 20) {
                    logEntries.removeChild(logEntries.firstChild);
                }
            }
            
            update() {
                this.updateParticles();
                this.updateSpells();
                this.updateSwordTrails();
            }
            
            render() {
                this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);
                
                this.drawBackground();
                this.drawParticles();
                this.drawSwordTrails();
                this.drawSpells();
                this.drawPlayer();
                this.drawMonster();
            }
            
            startGameLoop() {
                const gameLoop = () => {
                    this.update();
                    this.render();
                    requestAnimationFrame(gameLoop);
                };
                gameLoop();
            }
        }
        
        // Global game instance
        let game;
        
        // Initialize game when page loads
        window.addEventListener('load', () => {
            game = new PvECombatGame();
        });
        
        // Combat functions
        function selectCharacter(character) {
            if (!game) return;
            
            game.currentCharacter = character;
            document.getElementById('current-character').textContent = character;
            
            // Update UI
            document.querySelectorAll('.character-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            game.logMessage(`Selected ${character} character`, 'engage');
        }
        
        function engageMonster() {
            if (!game || !game.selectedMonster) return;
            
            game.isEngaged = true;
            game.combatActive = true;
            
            document.getElementById('attack-btn').disabled = false;
            document.getElementById('cast-btn').disabled = false;
            document.getElementById('engage-btn').disabled = true;
            
            game.logMessage(`Engaged in combat with ${game.selectedMonster.name}!`, 'engage');
            
            // Add some epic battle particles
            for (let i = 0; i < 20; i++) {
                game.createParticle(
                    game.canvas.width / 2 + (Math.random() - 0.5) * 200,
                    game.canvas.height / 2 + (Math.random() - 0.5) * 200,
                    '#f39c12',
                    3 + Math.random() * 3,
                    (Math.random() - 0.5) * 4,
                    (Math.random() - 0.5) * 4,
                    60
                );
            }
        }
        
        function attackMonster() {
            if (!game || !game.isEngaged || !game.selectedMonster) return;
            
            if (game.currentCharacter === 'knight') {
                game.knightAnimation.attacking = true;
                game.knightAnimation.attackFrame = 0;
                
                // Deal damage
                setTimeout(() => {
                    const damage = 15 + Math.random() * 20 + (game.knightAnimation.comboCount * 5);
                    game.damageMonster(damage);
                    
                    // Create sword slash effect
                    game.createExplosion(
                        game.selectedMonster.x,
                        game.selectedMonster.y,
                        game.knightAnimation.fireIntensity > 0.5 ? '#FF4500' : '#FFD700',
                        10
                    );
                }, 150);
                
                game.logMessage(`Knight attacks with blazing sword!`, 'damage');
            } else {
                // Basic wizard attack
                game.createMagicSpell(
                    game.player.x + 20,
                    game.player.y - 40,
                    game.selectedMonster.x,
                    game.selectedMonster.y
                );
                
                game.logMessage(`Wizard casts magic missile!`, 'cast');
            }
        }
        
        function castSpell() {
            if (!game || !game.isEngaged || !game.selectedMonster) return;
            
            if (game.currentCharacter === 'wizard') {
                game.wizardAnimation.casting = true;
                game.wizardAnimation.castFrame = 0;
                
                // Create multiple spell projectiles in a fan pattern
                setTimeout(() => {
                    const angles = [-0.3, 0, 0.3];
                    angles.forEach((angleOffset, index) => {
                        setTimeout(() => {
                            const targetX = game.selectedMonster.x + Math.sin(angleOffset) * 50;
                            const targetY = game.selectedMonster.y + Math.cos(angleOffset) * 50;
                            
                            game.createMagicSpell(
                                game.player.x + 20,
                                game.player.y - 40,
                                targetX,
                                targetY
                            );
                        }, index * 100);
                    });
                }, 200);
                
                game.logMessage(`Wizard casts ARCANE BARRAGE!`, 'cast');
            } else {
                // Knight special attack
                game.knightAnimation.attacking = true;
                game.knightAnimation.attackFrame = 0;
                game.knightAnimation.attackSpeed = 3;
                game.knightAnimation.fireIntensity = 1;
                
                setTimeout(() => {
                    const damage = 30 + Math.random() * 40;
                    game.damageMonster(damage);
                    
                    // Massive fire explosion
                    game.createExplosion(game.selectedMonster.x, game.selectedMonster.y, '#FF4500', 25);
                    
                    // Screen shake effect
                    game.canvas.style.transform = 'translate(' + (Math.random() - 0.5) * 10 + 'px, ' + (Math.random() - 0.5) * 10 + 'px)';
                    setTimeout(() => {
                        game.canvas.style.transform = 'translate(0, 0)';
                    }, 100);
                }, 200);
                
                game.logMessage(`Knight unleashes INFERNAL STRIKE!`, 'cast');
            }
        }
    </script>
</body>
</html>